<div class="siliconflow-extension-settings">
    <!-- 语音功能（TTS）主折叠面板 -->
    <div class="inline-drawer">
        <div class="inline-drawer-header inline-drawer-toggle">
            <div class="header-content">
                <i class="fa-solid fa-microchip"></i>
                <b>硅基流动 语音合成 (TTS)</b>
            </div>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down"></div>
        </div>

        <div class="inline-drawer-content" style="display: none;">
            
            <!-- 第一部分：API 配置 -->
            <div class="sub-section">
                <h4><i class="fa-solid fa-gears"></i> API 连接设置</h4>
                <div class="setting-item">
                    <label for="siliconflow_api_key">API 密钥</label>
                    <input id="siliconflow_api_key" type="password" placeholder="sk-..." />
                </div>
                
                <div class="setting-item">
                    <label for="siliconflow_api_url">API 接口地址</label>
                    <input id="siliconflow_api_url" type="text" placeholder="https://api.siliconflow.cn/v1" />
                    <small>支持兼容 OpenAI 格式的转发地址</small>
                </div>
                
                <div class="button-group">
                    <button id="test_siliconflow_connection" class="menu_button">
                        <i class="fa-solid fa-link"></i> 测试连接
                    </button>
                    <button id="save_siliconflow_settings" class="menu_button">
                        <i class="fa-solid fa-floppy-disk"></i> 保存配置
                    </button>
                    <span id="connection_status">未连接</span>
                </div>
            </div>

            <!-- 第二部分：模型与音色 -->
            <div class="sub-section">
                <h4><i class="fa-solid fa-robot"></i> 模型与音色配置</h4>
                
                <div class="setting-item">
                    <label for="tts_model">选择 TTS 模型</label>
                    <div style="display: flex; gap: 8px;">
                        <select id="tts_model" style="flex: 1;">
                            <option value="FunAudioLLM/CosyVoice2-0.5B">CosyVoice2-0.5B (默认)</option>
                        </select>
                        <button id="refresh_models" class="menu_button" title="从云端刷新模型列表">
                            <i class="fa-solid fa-rotate"></i>
                        </button>
                    </div>
                </div>
                
                <div class="setting-item">
                    <label for="tts_voice">语音角色 / 音色</label>
                    <select id="tts_voice"></select>
                </div>

                <div class="setting-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="setting-item">
                        <label for="tts_speed">语速: <span id="tts_speed_value">1.0</span></label>
                        <input type="range" id="tts_speed" min="0.25" max="4" step="0.25" value="1" />
                    </div>
                    <div class="setting-item">
                        <label for="tts_gain">音量: <span id="tts_gain_value">0</span></label>
                        <input type="range" id="tts_gain" min="-10" max="10" step="1" value="0" />
                    </div>
                </div>
            </div>

            <!-- 文本截取与排除设置 -->
<div class="sub-section">
    <h4><i class="fa-solid fa-filter"></i> 文本过滤与排除</h4>
    
    <div class="setting-item">
        <label for="tts_exclude_regex">排除正则表达式 (Regex)：</label>
        <input type="text" id="tts_exclude_regex" placeholder="例如：/\[.*?\]/g 或 /摘要.*/g" />
        <small>匹配到的文字将被<b>剔除</b>，不进行朗读。支持标准 JS 正则格式。</small>
    </div>

    <div class="extraction-config" style="margin-top:15px; border-top: 1px dashed rgba(255,255,255,0.1); padding-top:10px;">
        <small style="margin-bottom: 10px; display: block; opacity: 0.8;">
            <i class="fa-solid fa-circle-info"></i> <b>包含模式：</b>只朗读特定符号内的内容（如对话）。
        </small>
        <div class="input-pair" style="display: flex; gap: 10px;">
            <div class="setting-item" style="flex: 1;">
                <label>开始标记</label>
                <input type="text" id="image_text_start" placeholder="“, ( , 「" />
            </div>
            <div class="setting-item" style="flex: 1;">
                <label>结束标记</label>
                <input type="text" id="image_text_end" placeholder="”, ) , 」" />
            </div>
        </div>
    </div>
</div></div>

            <!-- 第四部分：音色克隆 -->
            <div class="sub-section">
                <h4><i class="fa-solid fa-id-card-clip"></i> 音色克隆 (CosyVoice)</h4>
                <div class="setting-item">
                    <input type="text" id="clone_voice_name" placeholder="音色名称 (字母/数字)" />
                </div>
                <div class="setting-item">
                    <textarea id="clone_voice_text" rows="2" placeholder="输入音频中的参考文本内容..."></textarea>
                </div>
                <div class="setting-item">
                    <label class="file-input-label" for="clone_voice_audio">
                         选择参考音频文件
                    </label>
                    <input type="file" id="clone_voice_audio" accept="audio/*" style="font-size: 0.8em;" />
                </div>
                <div class="button-group">
                    <button id="upload_voice" class="menu_button primary">
                        <i class="fa-solid fa-cloud-arrow-up"></i> 开始上传
                    </button>
                    <button id="refresh_custom_voices" class="menu_button">
                        <i class="fa-solid fa-arrows-rotate"></i> 刷新列表
                    </button>
                </div>
                <div class="setting-item" style="margin-top: 10px;">
                    <label>已保存的自定义音色：</label>
                    <div id="custom_voices_list" class="voice-list-container">
                        <small>暂无数据</small>
                    </div>
                </div>
            </div>

            <!-- 第五部分：测试 -->
            <div class="sub-section">
                <h4><i class="fa-solid fa-vial"></i> 语音测试</h4>
                <div class="setting-item">
                    <textarea id="tts_test_text" placeholder="输入测试内容...">你好，连接成功，准备出发。</textarea>
                </div>
                <button id="test_tts" class="menu_button" style="width: 100%;">
                    <i class="fa-solid fa-play"></i> 生成并试听
                </button>
                <div id="tts_output" style="margin-top: 10px; text-align: center;"></div>
            </div>

        </div>
    </div>
</div>

